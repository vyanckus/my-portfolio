# ApplicationFibonacciTesting

Этот проект демонстрирует техники тестирования для Spring Boot приложения, которое вычисляет и хранит числа Фибоначчи. В проекте используются JUnit 5, Mockito и Testcontainers для обеспечения надежности и корректности приложения.

## Описание проекта

Приложение вычисляет числа Фибоначчи и сохраняет ранее вычисленные значения в базе данных. При повторном запросе на то же самое число приложение извлекает сохраненное значение из базы данных, а не пересчитывает его.

Приложение построено с использованием Spring Boot и состоит из следующих компонентов:

*   **FibonacciCalculator:** Вычисляет число Фибоначчи для заданного индекса.
*   **FibonacciRepository:** Spring Data JPA репозиторий для хранения вычисленных чисел Фибоначчи.
*   **FibonacciService:** Сервис, который извлекает числа Фибоначчи из базы данных (если они там есть) или вычисляет их с помощью `FibonacciCalculator`, сохраняет результат в базе данных и возвращает значение.
*   **FibonacciController:** Spring MVC контроллер, который обрабатывает запросы пользователей, вызывает сервис и возвращает результат.

## Используемые технологии

*   Java
*   Spring Boot
*   Spring Data JPA
*   JUnit 5
*   Mockito
*   Testcontainers
*   PostgreSQL

## Инструкции по установке и запуску

1.  **Предварительные требования:**
    *   Установленная Java версии 17 или выше.
    *   Установленный Apache Maven.
    *   Установленный Docker.

2.  **Клонируйте репозиторий**

3.  **Запустите Docker-контейнер с PostgreSQL:**

    Используйте предоставленный скрипт `run-postgres.sh` для запуска контейнера PostgreSQL:

    ```bash
    ./run-postgres.sh
    ```

***Важно!*** *Обратите внимание, что порт PostgreSQL должен быть 5434, как указано в `application.properties`.*

4.  **Запустите приложение:**

    Используйте Maven для запуска Spring Boot приложения:

    ```bash
    mvn spring-boot:run
    ```

    После запуска приложение будет доступно через ваш браузер или API-клиент.

## Тестирование

Этот проект включает различные типы тестов для обеспечения функциональности приложения:

### 1. Юнит-тесты для `FibonacciCalculator`

*   Расположение: `src/test/java/.../FibonacciCalculatorTest.java`
*   Цель: Проверка класса `FibonacciCalculator` изолированно.
*   Инструменты: JUnit 5 Assertions.
*   Описание: Эти тесты проверяют, что `FibonacciCalculator` правильно вычисляет числа Фибоначчи для различных входных значений.

### 2. Юнит-тесты для `FibonacciService`

*   Расположение: `src/test/java/com/skillbox/fibonacci/FibonacciServiceTest.java`
*   Цель: Проверка класса `FibonacciService` с использованием моков для его зависимостей.
*   Инструменты: JUnit 5, Mockito.
*   Описание: Эти тесты проверяют логику внутри `FibonacciService`, удостоверяясь, что он правильно взаимодействует с моками `FibonacciRepository` и `FibonacciCalculator`. Они охватывают сценарии, такие как извлечение значений из базы данных и вычисление новых значений.

### 3. Интеграционные тесты для работы с базой данных для `FibonacciRepository`

*   Расположение: `src/test/java/com/skillbox/fibonacci/FibonacciRepositoryTest.java`
*   Цель: Проверка взаимодействия с базой данных PostgreSQL с использованием Spring Data JPA.
*   Инструменты: JUnit 5, Spring Data JPA, Testcontainers, `@DataJpaTest`.
*   Описание: Эти тесты проверяют, что `FibonacciRepository` правильно сохраняет и извлекает данные из базы данных. Они используют Testcontainers для создания легковесного, изолированного экземпляра PostgreSQL для тестирования. `JdbcTemplate` используется для проверки состояния.

### 4. API-тесты для `FibonacciController`

*   Расположение: `src/test/java/com/skillbox/fibonacci/FibonacciControllerTest.java`
*   Цель: Проверка REST API, предоставляемого классом `FibonacciController`.
*   Инструменты: JUnit 5, Spring Boot Test, MockMvc, `@SpringBootTest`, `@AutoConfigureMockMvc`.
*   Описание: Эти тесты имитируют HTTP-запросы к API-endpoint'ам и проверяют ответы. Они охватывают следующие сценарии:
    *   Успешное получение числа Фибоначчи для допустимого индекса (статус 200).
    *   Получение сообщения об ошибке для недопустимого индекса (статус 400).

## API Endpoints

Доступен следующий API endpoint:

*   **`GET /fibonacci/{index}`:** Извлекает число Фибоначчи для заданного индекса.
    *   **Параметры:**
        *   `index` (Integer): Индекс числа Фибоначчи, которое нужно извлечь.
    *   **Ответы:**
        *   **200 OK:** Возвращает число Фибоначчи в формате JSON. Пример: `{"index":10, "value": 55}`
        *   **400 Bad Request:** Возвращает сообщение об ошибке, если индекс недопустим (меньше 1).

## Автор

Вянцкус Фёдор
